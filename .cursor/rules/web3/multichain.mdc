---
description: General multichain address validation patterns and best practices
alwaysApply: false
---
# Multichain Rules

## Core Principles
- Always validate addresses based on chain type before use
- Use chain-specific libraries when available (viem for EVM, @solana/web3.js for Solana)
- Never cast addresses directly - always validate first
- Follow RORO pattern for validation functions
- Document address formats per chain in code comments
- **Delegate to chain-specific rules** for implementation details

## Address Validation Pattern
This rule coordinates multichain validation. For implementation details, see chain-specific rules:
```tsx
import type { ChainType } from '@repo/utils/web3'

// RORO pattern for validation - delegates to chain-specific rules
export function validateAddress({ address, chainType }: { address: string; chainType: ChainType }): boolean {
  switch (chainType) {
    case 'evm':
      // See @.cursor/rules/web3/viem.mdc for EVM address validation
      return validateEVMAddress(address)
    case 'solana':
      // See @.cursor/rules/web3/solana.mdc for Solana address validation
      return validateSolanaAddress(address)
    case 'cosmos':
      // See @.cursor/rules/web3/cosmos.mdc for Cosmos address validation
      return validateCosmosAddress(address)
    default:
      return false
  }
}
```

## Chain-Specific Libraries
This rule delegates to chain-specific rules for implementation:
- **EVM**: See @.cursor/rules/web3/viem.mdc - Use `getAddress()` from `viem` v2.44.4
- **Solana**: See @.cursor/rules/web3/solana.mdc - Use `PublicKey` from `@solana/web3.js` v1.98.4
- **Cosmos**: See @.cursor/rules/web3/cosmos.mdc - Use Bech32 validation
- **Other chains**: Use appropriate validation libraries when available

## Error Handling
```tsx
// Provide chain-aware error messages
if (!validateAddress({ address: to, chainType })) {
  throw new BadRequestException(
    `Invalid address format for chain type ${chainType}. Please provide a valid ${chainType} address.`
  )
}
```

## Best Practices
1. **Validate Early**: Check address format before creating transactions
2. **Chain-Aware Errors**: Provide helpful error messages indicating expected format
3. **Use Libraries**: Leverage existing validation libraries instead of custom regex when possible
4. **Document Formats**: Comment address formats in code for reference
5. **Fail Fast**: Return false immediately on validation failure

## Related
- @.cursor/rules/web3/viem.mdc - EVM address validation
- @.cursor/rules/web3/solana.mdc - Solana address validation
- @.cursor/rules/web3/cosmos.mdc - Cosmos address validation
