---
description: TypeScript coding standards and best practices
globs: *.tsx,*.ts
alwaysApply: false
---

# TypeScript Rules

## Core Principles
- Prefer interfaces over types for object definitions
  - Exception: unions, utility types (e.g., `z.infer<typeof schema>`), mapped types use `type`
- Avoid enums; use maps or union types instead
- Use descriptive variable names with auxiliary verbs (e.g., `isLoading`, `hasError`)
- Follow RORO for function arguments only when there are multiple parameters
- Use lowercase-with-dashes for directories (e.g., `components/auth-wizard`)
- Favor named exports (exception: Next.js pages/layouts require default exports)
- Prefer functional & declarative patterns; avoid classes
- Infer types and keep them inline unless you need to reuse them
- CRITICAL: Always follow eslint rules when generating code

## Framework Exceptions
- Next.js: `app/**/page.tsx` and `app/**/layout.tsx` require default exports
- Elysia: fully functional; no classes or decorators

## Code Style
- Allow single-line if without braces: `if (!value) return null`
- Allow single-line arrow bodies: `const double = (x: number) => x * 2`
- Prefer simple one-liners for trivial conditionals; avoid extra braces/elses

## Modularization and Imports
- Use `@vencura/lib` for shared utilities (error, async, env, zod helpers)
- Use Zod for schema validation + inference (`z.infer<typeof schema>`)
- Prefer importing types from `@vencura/core` over `@vencura/types` when re-exported
- Schema imports should use `@vencura/types/schemas` when not re-exported from `@vencura/core`
- Lodash: prefer `lodash-es` and per-function imports for tree-shaking + RSC safety  
  - ✅ `import isEmpty from "lodash-es/isEmpty"`  
  - ❌ `import { isEmpty } from "lodash-es"`

## ESM & Architecture Safety
- Use `import type { X } from "..."` for type-only imports
- Avoid barrel `index.ts` re-exports across layers (especially in shared packages); prefer explicit module imports
- Exported API functions and route handlers must use explicit `Promise<...>` return types
- Zod schemas live next to the feature that owns them; only re-export centrally when there is real reuse

## ts-reset Type Safety
This monorepo uses `@total-typescript/ts-reset` configured globally via `config/typescript/reset.d.ts`.

## Type Safety Model: Zod-First, Boundary-Driven Validation
Validate untrusted data at runtime boundaries with Zod; rely on inferred types internally.

The following TS ESLint "unsafe" rules are intentionally disabled globally:
- `@typescript-eslint/no-unsafe-assignment`
- `@typescript-eslint/no-unsafe-call`
- `@typescript-eslint/no-unsafe-member-access`
- `@typescript-eslint/no-unsafe-return`
- `@typescript-eslint/no-unsafe-argument`

## Error Handling
- Fail fast with guard clauses and early returns; avoid unnecessary `else`
- Place the happy path last when it improves readability
- Validation functions that return result objects must never throw; always return a consistent `{ valid, error? }` shape

## Related Rules
- [React Rules](../frontend/react.mdc)
- [React Hooks Rules](../frontend/react-hooks.mdc)
- [Next.js Rules](../frontend/nextjs.mdc)
