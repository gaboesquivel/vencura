---
title: "ADR 005: Package Manager Selection"
description: "Migrated from pnpm to Bun for faster package installation and improved developer experience, while maintaining reliable workspace dependency resolution."
---

## Context

We need to select a package manager for our monorepo that:

- Works reliably with workspace dependencies
- Supports Next.js, NestJS, and Turbo monorepo setup
- Handles complex dependency resolution (e.g., `@tailwindcss/postcss` in workspace packages)
- Provides good performance and developer experience
- Is production-ready and well-supported

## Considered Options

### Option A – pnpm

Mature, workspace-optimized package manager.

**Pros**

- Correctly hoists and resolves dependencies across workspace packages
- Handles complex scenarios like `@tailwindcss/postcss` in `@workspace/ui` being accessible to `apps/web`
- Uses symlinks and proper node_modules structure for workspace packages
- Well-tested with Next.js, NestJS, and Turbo
- Mature support for monorepo patterns
- Extensive community adoption and documentation
- Battle-tested in production environments
- Reliable builds without workarounds
- Better tooling support (debugging, monitoring, CI/CD)
- No module resolution issues during builds
- Consistent behavior across development and production

**Cons**

- Slightly slower than Bun for package installation (acceptable trade-off)
- Not using Bun's runtime features (but we can use Node.js for runtime, Bun for scripts if needed)

### Option B – Bun

Fast, all-in-one runtime and package manager.

**Pros**

- Very fast package installation
- All-in-one runtime and package manager
- Modern tooling

**Cons**

- Encountered build failures with `Cannot find module '@tailwindcss/postcss'`
- Different workspace dependency resolution compared to pnpm
- Requires workarounds (e.g., duplicating dependencies) that add maintenance burden
- Newer workspace implementation with edge cases
- Less ecosystem testing for complex monorepo setups
- Potential for future compatibility issues
- Issues with Next.js builds in monorepo context
- Module resolution problems that don't occur with pnpm

## Decision

We initially used **pnpm** as our package manager, but have since migrated to **Bun**.

**Original decision (pnpm) reasons:**

- Correctly hoists and resolves dependencies across workspace packages (handles complex scenarios like `@tailwindcss/postcss`)
- Well-tested with Next.js, NestJS, and Turbo with mature support for monorepo patterns
- Battle-tested in production with reliable builds and no module resolution issues
- Extensive community adoption and documentation with better tooling support

**Migration to Bun (2024):**

After Bun's workspace support matured and resolved previous issues, we migrated to Bun for:

- **Faster package installation**: Significantly faster dependency installation and updates
- **Improved developer experience**: Faster script execution and better performance
- **Mature workspace support**: Bun's workspace implementation has improved and now handles complex monorepo scenarios reliably
- **Compatibility**: Works seamlessly with Turbo, Next.js, and NestJS in our monorepo setup
- **Modern tooling**: All-in-one package manager with excellent TypeScript and Node.js compatibility

## Notes

- **Runtime**: We continue to use Node.js for runtime (especially for NestJS + WebSockets compatibility)
- **Workspace protocol**: Bun supports `workspace:*` protocol for internal package dependencies
- **Lockfile**: Bun uses `bun.lockb` binary lockfile format (committed to repository)
- **CI/CD**: All GitHub Actions workflows updated to use Bun setup action
