---
title: "API Development"
description: "REST API with Fastify, OpenAPI generation, and automatic client generation using Hey API."
---

## Overview

We use a **Fastify REST API** that exposes **OpenAPI** specifications. The OpenAPI spec is generated from Fastify routes, and we use **Hey API** to generate TypeScript clients from the spec.

## Architecture

**Fastify routes** define the API endpoints using **TypeBox** schemas (native JSON Schema). The **OpenAPI spec** is automatically generated from route definitions via `generate-openapi.ts`. **Hey API** generates type-safe TypeScript clients with **Zod schemas** from the OpenAPI spec.

**Data Flow:** TypeBox (Backend) → OpenAPI Spec → Zod Schemas + Types (Frontend)

## Benefits

- ✅ **End-to-end type safety** - Types flow from routes → OpenAPI spec → generated clients automatically
- ✅ **No duplication** - Define routes once, generate OpenAPI spec and clients automatically
- ✅ **Automatic OpenAPI generation** - OpenAPI spec generated from Fastify routes via `generate-openapi.ts`
- ✅ **Automatic client generation** - Hey API generates fully typed TypeScript clients from the generated spec
- ✅ **OpenAPI standard** - Industry-standard format for API specifications
- ✅ **Framework portability** - Works with Fastify, Express, or any framework
- ✅ **Multi-language support** - Generate clients for TypeScript, Python, Go, Rust, etc.

## Simple Example

**1. Implement Routes** (`apps/fastify/src/routes/`)

Fastify routes are implemented with TypeBox schemas (native JSON Schema):

```typescript
import { Type } from '@sinclair/typebox'

const HealthResponseSchema = Type.Object({
  ok: Type.Literal(true),
  now: Type.String({ format: 'date-time' }),
})

fastify.get('/health', {
  schema: {
    response: {
      200: HealthResponseSchema,
    },
  },
}, async (request, reply) => {
  return reply.send({
    ok: true,
    now: new Date().toISOString(),
  })
})
```

**2. Generate OpenAPI Spec** (`apps/fastify/openapi/openapi.json`)

The OpenAPI spec is automatically generated from Fastify routes:

```bash
pnpm generate:openapi
```

This runs `generate-openapi.ts` which scans route definitions and generates the OpenAPI specification.

**3. Generate TypeScript Client** (`packages/core`)

Hey API generates type-safe clients from the generated OpenAPI spec:

```typescript
// Generated by @hey-api/openapi-ts
import { createClient } from './gen/client'

const client = createClient({
  baseUrl: 'https://api.example.com',
})
```

**4. Client Usage** (`apps/next`)

```typescript
import { createApi } from '@repo/core'
import { useHealthCheck } from '@repo/react'

const api = createApi({
  baseUrl: process.env.NEXT_PUBLIC_API_URL!,
  getAuthToken: async () => session?.token,
})

// Fully typed API call
const health = await api.healthCheck()

// Or use React Query hooks
const { data } = useHealthCheck()
// data is fully typed from OpenAPI spec
```

## Workflow

1. **Implement routes** - Define Fastify routes with schemas in `apps/fastify/src/routes/`
2. **Generate OpenAPI spec** - Run `pnpm generate:openapi` to generate OpenAPI 3.0 spec in `apps/fastify/openapi/`
3. **Generate clients** - Hey API generates TypeScript clients in `packages/core` and `packages/react` from the spec
4. **Use in client** - Import and use generated typed clients

## Client Consumption

Clients consume the API through generated TypeScript clients:

```typescript
import { createApi } from '@repo/core'
import { useHealthCheck } from '@repo/react'

// Runtime-agnostic client
const api = createApi({
  baseUrl: process.env.NEXT_PUBLIC_API_URL!,
  getAuthToken: async () => session?.token,
})

// Fully typed API call
const health = await api.healthCheck()

// Or use React Query hooks (generated from OpenAPI spec)
const { data, isLoading, error } = useHealthCheck()
```

The generated clients:
- Provide full type safety from routes → OpenAPI spec → components
- Handle authentication and headers automatically
- Work with TanStack Query for caching and state management
- Are generated by Hey API from the OpenAPI spec (which is generated from routes)

## OpenAPI Integration

OpenAPI 3.0 specs are automatically generated from Fastify routes:
- Generated at `apps/fastify/openapi/openapi.json` via `generate-openapi.ts`
- Served at `/reference/openapi.json` (programmatic access)
- Scalar UI at `/reference` (interactive docs)
- MCP integration for AI agents
- Multi-language SDK generation using Hey API and standard OpenAPI tools

### SDK Generation

**TypeScript**: Generated by `@hey-api/openapi-ts` from the generated OpenAPI spec. **Other languages**: Use standard OpenAPI generators (`openapi-generator`, `oapi-codegen`, `progenitor`). All clients are generated from the same OpenAPI spec (which is generated from routes), ensuring consistency.

## Related Documentation

- [OpenAPI Generation](/docs/core-concepts/openapi-generation) - TypeBox → OpenAPI → Zod clients workflow
- [Packages Reference](/docs/core-concepts/packages) - Complete reference for all shared packages
- [Backend Stack](/docs/architecture/backend-stack) - Fastify and backend architecture
- [Package Conventions](/docs/architecture/package-conventions) - Detailed package architecture
